<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>請假申請表</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
    <h2>請假申請表</h2>
    <form id="leaveForm">
        <label>姓名：</label>
        <input type="text" id="name" required><br>

        <label>日期：</label>
        <input type="date" id="date" required><br>

        <label>年級：</label>
        <select id="grade">
            <option value="一年級">一年級</option>
            <option value="二年級">二年級</option>
            <option value="三年級">三年級</option>
        </select><br>

        <label>請假事由：</label>
        <textarea id="reason" required></textarea><br>

        <button type="button" onclick="submitLeave()">提交</button>
    </form>

    <script>
        const LINE_ACCESS_TOKEN = "VPI15bRAuAzGunrudPQsZ4gT0tL2BOIkO/qju+t3/4gkDcw+nx1JBS5BNMkhgfG/PIHvVNY8xZMzA/REz4ycMY l6DreoDD5uLh0OcSUwepfJ88Wl5nIUCtKzFJPnNplixXOp4LjVpSqwHip9vk/CWAdB04t89/1O/w1cDnyilFU=";  
        const ADMIN_USER_ID = "Ub6bb0555e1a66d109de7d7ccdc7c8091";  // 你的管理員 User ID

        async function initLiff() {
            try {
                await liff.init({ liffId: "2007183553-2Y7WQ8vj" });  // 這裡仍然需要 LIFF ID
                console.log("LIFF 初始化成功");
            } catch (error) {
                console.error("LIFF 初始化錯誤:", error);
            }
        }

        function submitLeave() {
            // 獲取表單資料
            const name = document.getElementById("name").value;
            const date = document.getElementById("date").value;
            const grade = document.getElementById("grade").value;
            const reason = document.getElementById("reason").value;

            // 設置請假訊息內容
            let msg = `請假申請\n姓名: ${name}\n日期: ${date}\n年級: ${grade}\n請假事由: ${reason}`;

            // 發送請假訊息給管理員
            sendLineMessage(msg);

            // 提交完成後的提示
            alert("請假申請已提交！");

            // 清空表單
            document.getElementById("leaveForm").reset();
        }

    function sendLineMessage(message) {
        fetch("https://api.line.me/v2/bot/message/push", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "Authorization": `Bearer ${LINE_ACCESS_TOKEN}`
            },
            body: JSON.stringify({
                to: ADMIN_USER_ID,
                messages: [{ type: "text", text: message }]
            })
        })
        .then(response => response.text())  // 先轉成 text，看看回應內容
        .then(data => {
            console.log("API 回應：", data);  // 顯示完整回應
            alert("API 回應：" + data);  // 讓你直接看到錯誤訊息
        })
        .catch(error => {
            console.error("發送請求時發生錯誤：", error);
            alert("發送訊息失敗：" + error);
        });
    }




        // 初始化 LIFF（不強制登入）
        initLiff();
    </script>
</body>
</html>
